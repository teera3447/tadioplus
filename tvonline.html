<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Tadio+ (Video.js Edition)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link href="https://vjs.zencdn.net/8.10.0/video-js.css" rel="stylesheet" />
    <link href="https://unpkg.com/@videojs/themes@1.0.1/dist/fantasy/index.css" rel="stylesheet">

    <style>
        :root { 
            --bg: #0f172a; --panel: #020617; --accent: #38bdf8; --text: #f8fafc; 
        }

        body { 
            margin: 0; font-family: 'Segoe UI', sans-serif; 
            background: var(--bg); color: var(--text); overflow: hidden; 
        }

        header { 
            padding: 15px; background: var(--panel); text-align: center; 
            border-bottom: 1px solid #1e293b; font-weight: bold;
        }

        #app { display: flex; height: calc(100vh - 56px); }

        /* ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á Player ‡πÉ‡∏´‡πâ‡πÄ‡∏ï‡πá‡∏°‡∏Å‡∏£‡∏≠‡∏ö */
        #playerWrap { 
            flex: 1; background: #000; display: flex; flex-direction: column;
        }
        
        .video-js { width: 100% !important; height: 100% !important; }

        #channels { 
            width: 320px; background: var(--panel); 
            display: flex; flex-direction: column; border-left: 1px solid #1e293b; 
        }

        .search-box { padding: 15px; }
        input { 
            width: 100%; padding: 10px; border-radius: 6px; border: 1px solid #334155; 
            background: #1e293b; color: #fff; box-sizing: border-box; outline: none;
        }

        #list { flex: 1; overflow-y: auto; }
        .channel { 
            padding: 12px 15px; border-bottom: 1px solid #1e293b; 
            cursor: pointer; font-size: 14px; display: flex; align-items: center; gap: 12px;
        }
        .channel:hover { background: #1e293b; }
        .channel.active { border-left: 4px solid var(--accent); background: #1e293b; }
        .channel img { width: 35px; height: 35px; object-fit: contain; background: #fff; border-radius: 4px; }

        .status-bar { padding: 10px; background: #020617; font-size: 12px; color: #94a3b8; border-top: 1px solid #1e293b; }

        @media(max-width: 768px) { 
            #app { flex-direction: column; } 
            #channels { width: 100%; height: 45vh; } 
        }
    </style>
</head>
<body>

<header>Tadio+ TV ONLINE (Video.js)</header>

<div id="app">
    <div id="playerWrap">
        <video id="my-video" class="video-js vjs-theme-fantasy" controls preload="auto" playsinline></video>
        <div class="status-bar" id="status">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö...</div>
    </div>

    <div id="channels">
        <div class="search-box">
            <input type="text" id="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡πà‡∏≠‡∏á..." oninput="filter()">
        </div>
        <div id="list"></div>
    </div>
</div>

<script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

<script>
    /** * CONFIGURATION: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô URL ‡πÄ‡∏õ‡πá‡∏ô Worker ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
     */
    const BASE_WORKER_URL = "https://iptv.tadioplus.workers.dev"; 
    const M3U_URL = `${BASE_WORKER_URL}/list`; 
    const PROXY   = `${BASE_WORKER_URL}/?url=`;

    let allChannels = [];
    const statusText = document.getElementById('status');
    
    // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡∏ß‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô Video.js
    const player = videojs('my-video', {
        fluid: false,
        autoplay: false,
        responsive: true,
        controlBar: {
            children: [
                'playToggle',
                'volumePanel',
                'currentTimeDisplay',
                'timeDivider',
                'durationDisplay',
                'progressControl',
                'liveDisplay', // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° LIVE ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö HLS
                'fullscreenToggle',
            ],
        }
    });

    // 1. ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á
    async function loadM3U() {
        try {
            const response = await fetch(M3U_URL);
            const data = await response.text();
            const lines = data.split('\n');
            const channels = [];
            
            for (let i = 0; i < lines.length; i++) {
                if (lines[i].startsWith('#EXTINF:')) {
                    const info = lines[i];
                    const url = lines[i + 1]?.trim();
                    if (url && url.startsWith('http')) {
                        const name = info.split(',')[1] || "Unknown Channel";
                        const logoMatch = info.match(/tvg-logo="([^"]+)"/);
                        const logo = logoMatch ? logoMatch[1] : "";
                        channels.push({ name, url, logo });
                    }
                }
            }
            allChannels = channels;
            render(allChannels);
            statusText.innerText = `‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô: ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡πâ‡∏ß ${allChannels.length} ‡∏ä‡πà‡∏≠‡∏á`;
        } catch (error) {
            statusText.innerText = "Error: ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ä‡πà‡∏≠‡∏á‡πÑ‡∏î‡πâ";
        }
    }

    // 2. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Proxy
    function fixUrl(url) {
        if (url.includes('livedoomovies') || url.includes('m3u8') || !url.startsWith('https://')) {
            return PROXY + encodeURIComponent(url);
        }
        return url;
    }

    // 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡πà‡∏ô (Video.js version)
    function play(ch, el) {
        const finalUrl = fixUrl(ch.url);
        
        // UI Highlighting
        document.querySelectorAll('.channel').forEach(i => i.classList.remove('active'));
        el.classList.add('active');
        statusText.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠: " + ch.name;

        // ‡∏™‡∏±‡πà‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Source ‡πÉ‡∏ô Video.js
        player.src({
            src: finalUrl,
            type: 'application/x-mpegURL' // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô HLS
        });

        player.play().catch(err => {
            console.log("Autoplay blocked or link error");
        });

        player.on('playing', () => {
            statusText.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏â‡∏≤‡∏¢: " + ch.name;
        });

        player.on('error', () => {
            statusText.innerText = "‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏•‡πà‡∏ô‡∏ä‡πà‡∏≠‡∏á‡∏ô‡∏µ‡πâ (‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏≠‡∏≤‡∏à‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏)";
        });
    }

    function filter() {
        const txt = document.getElementById('search').value.toLowerCase();
        render(allChannels.filter(c => c.name.toLowerCase().includes(txt)));
    }

    function render(data) {
        const container = document.getElementById('list');
        container.innerHTML = "";
        data.forEach(ch => {
            const div = document.createElement('div');
            div.className = 'channel';
            const img = ch.logo ? `<img src="${ch.logo}" onerror="this.style.display='none'">` : 'üì∫';
            div.innerHTML = `${img} <span>${ch.name}</span>`;
            div.onclick = () => play(ch, div);
            container.appendChild(div);
        });
    }

    loadM3U();
</script>
</body>
</html>
